<!DOCTYPE html>
<html lang="en">
{% load my_tag my_filter %}
<head>
    <meta charset="UTF-8">
    <title>tking个人博客</title>
    <link rel="stylesheet" href="/static/my/css/reset.css">
    <link rel="stylesheet" href="/static/my/css/base.css">
    {% block css %}
        <link rel="stylesheet" href="/static/my/css/index.css">
    {% endblock %}
    <!-- 引入样式 -->
    <link rel="stylesheet" href="/static/elementui/theme-chalk/index.css">
    <link rel="stylesheet" href="/static/fontawesome/css/all.min.css">
    <script src="/static/vue/vue.js"></script>
    <script src="/static/jQuery/jquery.js"></script>
    <!-- 引入组件库 -->
    <script src="/static/elementui/index.js"></script>
</head>
<body>
<div id="app">
    <link rel="stylesheet" :href="'/static/my/css/theme/' + theme + '.css'">
    <nav class="nav_bg">
        <div class="left" id="dynamic_nav">
            {% dynamic_navigation request %}

            {% block search %}
                <div class="search">
                    <input type="text" @keydown.enter="search()" v-model="search_key" class="search_box"
                           placeholder="搜索你想要的内容...">
                    <button @click="search()"><i class="fa fa-search"></i></button>
                </div>
            {% endblock %}

        </div>
        <div class="right">
            <img v-show="theme==='light'" src="/static/my/imgs/nav/light.svg" @click="setTheme('dark')" alt="">
            <img v-show="theme==='dark'" src="/static/my/imgs/nav/dark.svg" @click="setTheme('light')" alt="">

            {% if request.user.username %}
                <el-dropdown>
  <span class="el-dropdown-link">
    {{ request.user.username }}<i class="el-icon-arrow-down el-icon--right"></i>
  </span>
                    <el-dropdown-menu slot="dropdown">
                        <el-dropdown-item><a href="/backend/">个人中心</a></el-dropdown-item>
                        <el-dropdown-item><a href="/backend/edit_avatar/">修改信息</a></el-dropdown-item>
                        <el-dropdown-item><a href="/backend/add_article">添加文章</a></el-dropdown-item>
                        <el-dropdown-item><a href="/admin/">后台管理</a></el-dropdown-item>
                        <el-dropdown-item><a href="/logout/">注销退出</a></el-dropdown-item>
                    </el-dropdown-menu>
                </el-dropdown>
            {% else %}
                <a href="/login">登录</a>
                <a href="/sign">注册</a>
            {% endif %}


        </div>
    </nav>

    {% block banner %}
        {% banner 'index' %}
    {% endblock %}

    <main>
        {% csrf_token %}
        {% block main %}
            <div class="main">
                <div class="left">
                    <div class="boutique card">
                        <div class="title">
                            <h2>精选文章</h2>
                            <div class="switch">
                                    <span :active="this_category === 'front'"
                                          @click="switch_article('front')">前端</span>
                                <span>-</span>
                                <span :active="this_category === 'back'" @click="switch_article('back')">后端</span>
                            </div>
                        </div>
                        <div class="content">
                            <ul v-show="this_category === 'front'" class="front">
                                {% for frontend in frontend_list %}
                                    <li>
                                        <div class="left">
                                            <div>
                                                <img src="{{ frontend.cover.url.url }}" alt="">
                                            </div>
                                        </div>
                                        <div class="right">
                                            <h2><a href="/article/{{ frontend.nid }}/">{{ frontend.title }}</a></h2>
                                            <p>{{ frontend.abstract }}</p>
                                            <span>{{ frontend.create_date|date_humanize }}</span>
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>

                            <ul v-show="this_category === 'back'" class="back">
                                {% for backend in backend_list %}
                                    <li>
                                        <div class="left">
                                            <div>
                                                <img src="{{ backend.cover.url.url }}" alt="">
                                            </div>
                                        </div>
                                        <div class="right">
                                            <h2><a href="/article/{{ backend.nid }}/">{{ backend.title }}</a></h2>
                                            <p>{{ backend.abstract }}</p>
                                            <span>{{ backend.create_date|date_humanize }}</span>
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="hot card">
                        <div class="title">
                            <h2 id="pos">今日热搜</h2>
                            <div>
                                <a href="/news/">查看更多</a>
                            </div>
                        </div>
                        <div class="content">
                            <div v-for="item in news_list" :key="item.index">
                                <span class="index">[[item.index]]</span> <a
                                    :href="item.link"
                                    target="_blank">[[item.title]]</a>
                                <span class="num">[[item.hotValue]]</span>
                            </div>
                            <ul style="list-style: none;">
                                <li style="display: flex;width: 100%;">
                                    <span class="index"
                                          style="width: 20px;height: 20px;background-color: #f0f1f4;border-radius: 5px; display: flex;justify-content: center;align-items: center; margin-right: 15px;">1</span>
                                    <a href="https://www.baidu.com/s?wd=%E4%B8%AD%E5%9B%BD-%E4%B8%AD%E4%BA%9A%E5%B3%B0%E4%BC%9A%E6%9C%89%E5%A4%9A%E9%87%8D%E8%A6%81"
                                       style="width: 77%;color: #333333;transition: all 0.2s;"
                                       target="_blank">中国-中亚峰会有多重要</a>
                                    <span class="num"
                                          style="width: 20%;display: flex;justify-content: right">495.9万</span>
                                </li>
                                <li style="display: flex;width: 100%;padding-top: 10px">
                                    <span class="index"
                                          style="width: 20px;height: 20px;background-color: #f0f1f4;border-radius: 5px; display: flex;justify-content: center;align-items: center; margin-right: 15px;">2</span>
                                    <a href="https://www.baidu.com/s?wd=%E4%B8%AD%E5%9B%BD-%E4%B8%AD%E4%BA%9A%E5%B3%B0%E4%BC%9A%E6%9C%89%E5%A4%9A%E9%87%8D%E8%A6%81"
                                       style="width: 77%;color: #333333;transition: all 0.2s;"
                                       target="_blank">中国-深圳70后女副区长白发照走红</a>
                                    <span class="num"
                                          style="width: 20%;display: flex;justify-content: right">497.3万</span>
                                </li>
                                <li style="display: flex;width: 100%;padding-top: 10px">
                                    <span class="index"
                                          style="width: 20px;height: 20px;background-color: #f0f1f4;border-radius: 5px; display: flex;justify-content: center;align-items: center; margin-right: 15px;">3</span>
                                    <a href="https://www.baidu.com/s?wd=%E4%B8%AD%E5%9B%BD-%E4%B8%AD%E4%BA%9A%E5%B3%B0%E4%BC%9A%E6%9C%89%E5%A4%9A%E9%87%8D%E8%A6%81"
                                       style="width: 77%;color: #333333;transition: all 0.2s;"
                                       target="_blank">女子官宣结婚被民警提醒赶紧分手</a>
                                    <span class="num"
                                          style="width: 20%;display: flex;justify-content: right">487.5万</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="all card">
                        <div class="title">
                            <h2>博客文章</h2>
                            <div>
                                <a href="#">查看更多</a>
                            </div>
                        </div>
                        <div class="content">
                            <ul class="article_content">
                                {% for article in article_list %}
                                    <li style="position: relative;overflow: hidden">
                                        <div class="category_flag" len="{{ article.get_category_display|length }}"
                                             type="{{ article.get_category_display }}"
                                             style="
                                             width: 200px;
                                             height: 26px;
                                             background-color: #dd5555;
                                             color: #ffffff;
                                             display: flex;
                                             justify-content: center;
                                             align-items: center;
                                             transform: rotate(45deg);


                                             position: absolute;
                                             top: 22px;
                                             right: -70px;"
                                        >
                                            {{ article.get_category_display }}
                                        </div>
                                        <div class="left">
                                            <div>
                                                <img src="{{ article.cover.url.url }}"
                                                     alt="">
                                            </div>
                                        </div>
                                        <div class="right">
                                            <h2><a href="/article/{{ article.nid }}/">{{ article.title }}</a></h2>
                                            <p>{{ article.abstract }}</p>
                                            <div class="article_info">
                                            <span>
                                                <i class="far fa-clock"></i>{{ article.create_date|date_humanize }}
                                            </span>
                                                <span>
                                                <i class="far fa-thumbs-up"></i>{{ article.digg_count }}
                                            </span>
                                                <span>
                                                <i class="far fa-eye"></i>{{ article.look_count }}
                                            </span>
                                                <span>
                                                <i class="far fa-comments"></i>{{ article.comment_count }}
                                            </span>
                                                <span>
                                                <i class="far fa-star"></i>{{ article.collects_count }}
                                            </span>
                                            </div>
                                            <a href="/article/{{ article.nid }}/" target="_blank">查看详情</a>
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                            <ul class="pager">
                                {{ pager.pager_html|safe }}
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="right">
                    {% if advert_list.count %}
                        <div class="ad card">
                            <div class="title">
                                <h2>代理广告</h2>
                                <div>
                                    <a href="#">申请</a>
                                </div>
                            </div>
                            <div class="content">
                                {% generate_advert advert_list %}
                            </div>
                        </div>
                    {% endif %}

                    <div class="my_card"
                         style="border-radius: 5px 5px 0 0;background-color: #ffffff;padding: 20px 20px 10px 20px;">
                        <div class="title" style="position: relative">
                            <h3 style="color: rosybrown;font-size: 26px;">个人名片</h3>
                            <h4 style="font-size: 36px;">MY</h4>
                            <h4 style="font-size: 36px;">PROFILE</h4>
                            <img src="/static/my/imgs/footer/qq_code.png" alt="我的QQ"
                                 style="
                                 width: 100px;
                                 cursor: pointer;
                                 position: absolute;
                                 top: 5px;
                                 right: 10px;"
                            >
                        </div>
                        <div class="weather">
                            <img id="weather" src="/static/my/imgs/24_terms/solo.jpeg" alt="24节气"
                                 style="
                                 transition: all 0.3s;
                                 cursor: pointer;
                                 border-radius: 5px;
                                 padding: 10px 0 10px 10px;
                                 width: 300px;
                                 height: 380px;"
                            >
                            <p>
                                <span style="color: orange">NAME</span>
                                <span>唐坤</span>
                            </p>
                            <p style="padding-top: 5px;">
                                <span style="color: orange">JOB</span>
                                <span>前端工程师</span>
                            </p>
                            <p style="padding-top: 5px;">
                                <span style="color: orange">ADDR</span>
                                <span>贵州铜仁</span>
                            </p>
                            <p style="padding-top: 5px;">
                                <span style="color: orange">WEB</span>
                                <span>www.tking123.com</span>
                            </p>
                        </div>
                    </div>

                    <div class="tags card">
                        <div class="title">
                            <h2>标签云</h2>
                        </div>
                        <div class="content">
                            <ul>
                                {% generate_tag_html %}
                            </ul>
                        </div>
                    </div>
                    <div class="siteInfo card">
                        <div class="title">
                            <h2>站点信息</h2>
                        </div>
                        <div class="content">
                            起飞
                        </div>
                    </div>
                    <div class="links card">
                        <div class="title">
                            <h2>友情链接</h2>
                        </div>
                        <div class="content">
                            起飞
                        </div>
                    </div>
                </div>
            </div>
        {% endblock %}
    </main>

    <footer>
        <div class="left">
            <p class="thank">Thank For</p>
            <p class="site_info">
                <span><img src="/static/my/imgs/footer/tencent.png" alt="">腾讯云服务器</span>
                <span><img src="/static/my/imgs/footer/tencent.png" alt="">腾讯云证书</span>
                <span><img src="/static/my/imgs/footer/qiniu.png" alt="">七牛云存储</span>
            </p>
            <p class="version">
                <span>version</span>
                <span>4.0.1</span>
            </p>
            <p>建站日期：2021-12-29</p>
            <p class="beian">
                <a href="https://beian.miit.gov.cn/">
                    <img src="http://www.fengfengzhidao.com/static/my/img/footer/badges.png" alt="">
                    <span>湘ICP备2021010654号-3</span>
                </a>
            </p>
        </div>
        <div class="right">
            <div class="contact">
                <div>
                    <img class="svg" src="/static/my/imgs/footer/qq_icon.svg" alt="">
                    <img class="code" src="/static/my/imgs/footer/qq_code.png" alt="">
                </div>
                <div>
                    <img class="svg" src="/static/my/imgs/footer/weixin_icon.svg" alt="">
                    <img class="code" src="/static/my/imgs/footer/qq_code.png" alt="">
                </div>
                <div>
                    <a href="https://www.baidu.com" target="_blank"></a>
                    <img class="svg" src="/static/my/imgs/footer/gitee_icon.svg" alt="">
                </div>
            </div>
            <p>
                联系方式：2543075727@qq.com
            </p>
        </div>
    </footer>
</div>

<script src="/static/axios/axios.js"></script>
<script>
    {#  axios请求中间件  #}
    axios.interceptors.request.use(
        request => {
            if (request.method !== 'get') {
                let csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value
                request.headers['X-CSRFToken'] = csrfToken
            }
            return request
        }
    )

    {#  axios响应中间件  #}
    axios.interceptors.response.use(
        response => {
            return response.data
        }
    )
    /*
        function dynamic_navigation() {
            let a_list = document.querySelectorAll('#dynamic_nav a')
            let path = location.pathname
            for (const a of a_list) {
                let a_href = a.getAttribute('href')
                if (a_href === path || a_href + '/' === path) {
                    a.classList.add('actives')
                }
            }
        }
        dynamic_navigation()
        */

    new Vue({
        el: '#app',
        delimiters: ["[[", "]]"],
        data: {
            theme: 'light',
            this_category: 'front',
            comment_content: '',
            isShowSlider: false,
            slider_list: [],
            search_key: '',
            news_list: [],
            news_init: [
                {name: '微博', id: 'KqndgxeLl9', url: 'https://files.codelife.cc/topsearch/KqndgxeLl9.png'},
                {name: '知乎', id: 'mproPpoq6O', url: 'https://files.codelife.cc/topsearch/mproPpoq6O.png'},
                {name: '微信', id: 'WnBe01o371', url: 'https://files.codelife.cc/topsearch/WnBe01o371.png'},
                {name: '百度', id: 'Jb0vmloB1G', url: 'https://files.codelife.cc/topsearch/Jb0vmloB1G.png'},
                {name: '哔哩哔哩', id: '74KvxwokxM', url: 'https://files.codelife.cc/topsearch/74KvxwokxM.png'},
                {name: '抖音', id: 'DpQvNABoNE', url: 'https://files.codelife.cc/topsearch/DpQvNABoNE.png'},
            ],
            news_actives: '微博',
            news_actives_url: 'https://files.codelife.cc/topsearch/KqndgxeLl9.png',

            mood_dialogVisible: false,
            mood_add: {
                name: '',
                avatar_id: null,
                content: '',
                drawing: '',
            },
            mood_show_drawing: [],
            mood_comment_dialogVisible: false,
            mood_add_comment: {
                name: '',
                content: '',
            },
            history_dialogVisible: false,
            history: {
                title: '',
                create_date: new Date(),
                content: '',
                drawing: '',
            }
        },

        created() {
            this.init_theme()

            let path = location.pathname
            if (path.indexOf('article') !== -1) {
                this.init_slider()
            }

            if (path.indexOf('search') !== -1) {
                this.init_search_key()
            }

            if (path.indexOf('news') !== -1) {
                this.news_init_method(0)
            }

            if (path.indexOf('/') !== -1) {
                this.news_init_method(1)
            }

            setTimeout(() => {
                this.get_sliderbar()
                this.code_copy()
            }, 1000)
        },


        methods: {
            // 初始化主题
            init_theme() {
                // 读取存储的配置信息
                let theme = localStorage.getItem('theme')
                if (theme) {
                    this.theme = theme
                }
            },

            // 设置主题
            setTheme(themeName) {
                this.theme = themeName
                // 持久化
                localStorage.setItem('theme', themeName)
            },

            // 选择前后端内容
            switch_article(category) {
                this.this_category = category
            },

            // 发布评论
            add_comment(nid) {
                axios.post(`/api/article/comment/${nid}/`, {content: this.comment_content}).then(res => {
                    if (res.code) {
                        if (res.self) {
                            this.$refs[`comment_${res.self}`].focus()
                        }
                        this.$message.error(res.msg)
                        return
                    }
                    this.$message.success(res.msg)
                    setTimeout(() => {
                        location.reload()
                    }, 500)
                })
            },

            // 将被评论人的用户名写入placeholder
            set_sub_placeholder(div, username, cid) {
                $(div).find('textarea').attr('placeholder', `@${username}`)
                $(div).find('textarea').attr('cid', cid)
            },

            // 展示子评论列表
            show_sub_comment_list(e, username, cid) {
                let div = $(e.target).parent().parent().next()
                $(div).slideToggle()
                this.set_sub_placeholder(div, username, cid)
            },

            // 子评论回复显示
            sub_comment_show_placeholder(e, username, cid) {
                let div = $(e.target).parents('.sub_comment_list')
                this.set_sub_placeholder(div, username, cid)
            },

            // 发布子评论
            add_sub_comment(e, nid) {
                axios.post(`/api/article/comment/${nid}/`, {
                    content: $(e.target).prev().val(),
                    pid: $(e.target).prev().attr('cid')
                }).then(res => {
                    if (res.code) {
                        if (res.self) {
                            this.$refs[`sub_comment_${res.self}`].focus()
                        }
                        this.$message.error(res.msg)
                        return
                    }
                    this.$message.success(res.msg)
                    setTimeout(() => {
                        location.reload()
                    }, 500)
                })
            },

            // 删除子评论
            delete_sub_comment(nid, aid, root_comment_id) {
                this.$confirm('此操作将删除该评论, 是否继续?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    axios.delete(`/api/article/comment/${nid}/`, {
                        data: {
                            aid,
                            pid: root_comment_id,
                        }
                    }).then(res => {
                        if (res.code) {
                            this.$message.error(res.msg)
                            return
                        }
                        this.$message.success(res.msg)
                        setTimeout(() => {
                            location.reload()
                        }, 1000)
                    })
                }).catch(() => {
                    this.$message({
                        type: 'warning',
                        message: '已取消删除'
                    });
                });
            },

            // 评论点赞
            comment_digg(e, nid) {
                axios.post(`/api/comment/digg/${nid}/`).then(res => {
                    if (res.code) {
                        this.$message.error(res.msg)
                        return
                    }
                    e.target.innerHTML = `点赞（${res.data}）`
                    this.$message.success(res.msg)
                })
            },

            // 文章点赞
            article_digg(e, nid) {
                let dom = e.target
                dom.classList.add('show')
                axios.post(`/api/article/digg/${nid}/`).then(res => {
                    if (res.code) {
                        this.$message.error(res.msg)
                        return
                    }
                    $(dom).next().text(res.data)
                    this.$message.success(res.msg)
                })

                let timer = null
                clearTimeout(timer)
                timer = setTimeout(() => {
                    dom.classList.remove('show')
                }, 1500)
            },

            // 文章收藏
            article_collects(e, nid) {
                let dom = e.target
                axios.post(`/api/article/collects/${nid}/`).then(res => {
                    if (res.code) {
                        this.$message.error(res.msg)
                        return
                    }
                    this.$message.success(res.msg)
                    $(dom).next().text(res.data)

                    if (res.isCollects) {
                        dom.classList.add('show')
                        return
                    }
                    dom.classList.remove('show')
                })
            },

            // 回到顶部
            go_to_top() {
                $('html, body').animate({
                    scrollTop: 0
                }, 1000)
            },

            init_slider() {
                let flag = localStorage.getItem('isShowSlider')
                if (flag) {
                    flag = eval(flag)
                    if (flag) {
                        this.isShowSlider = true
                        this.$nextTick(() => {
                            this.sliderChange(true)
                        })
                    }
                    return
                }
            },

            // 展开悬浮目录
            sliderChange(val) {
                let dom = this.$refs.slider
                localStorage.setItem('isShowSlider', val)

                if (val) {
                    dom.classList.add('show')
                    return
                }
                dom.classList.remove('show')
            },

            // 悬浮目录
            get_sliderbar() {
                let content = $('#article_content')
                let h_list = content.children('h1,h2,h3,h4')
                let lis = []
                for (let i = 0; i < h_list.length; i++) {
                    let c = h_list[i].innerText
                    let tagName = h_list[i].tagName
                    let tagId = h_list[i].id
                    let ele = {
                        tagName,
                        c,
                        pos: '#' + tagId
                    }
                    lis.push(ele)
                }
                lis.push({
                    tagName: 'H1',
                    c: '去评论',
                    pos: '.comment_submit'
                })

                this.slider_list = lis
            },

            // 悬浮目录点击跳转
            go_side_bar(selector, e) {
                $('.slider_bar .body>p').css('color', '')
                e.target.style.color = '#ff9800'
                let box = $(selector)
                let pos = box.offset()
                pos.top = pos.top - 80
                $('html, body').animate({scrollTop: pos.top}, 500)
            },

            // 代码一键复制
            code_copy() {
                $('pre').each(function () {
                    let copy = $('<i title="copy" class="el-icon-document-copy code-copy"></i>')
                    $(this).append(copy)
                })

                $('pre i.code-copy').click(e => {

                    let text_list = $(e.target).prev().find('code')
                    let text = ''
                    text_list.each(function () {
                        text += $(this).text() + '\n'
                    })
                    let element = $('<textarea>' + text + '</textarea>')
                    $('body').append(element)
                    element[0].select()
                    document.execCommand('Copy')
                    element.remove()

                    // 复制成功的提示信息
                    this.$message.success('复制成功！')

                })

            },

            // 点击搜索
            search(path = '/search/', target = '_blank') {
                let box = document.querySelector('.search')
                if (!box.classList.contains('show_search')) {
                    box.classList.add('show_search')
                    return
                }
                if (!this.search_key) {
                    box.classList.remove('show_search')
                    return
                }
                // 打开标签页
                if (path === '') {
                    window.open(path + '?key=' + this.search_key, name = target)
                    return
                }
                window.open(path + '?key=' + this.search_key + '&word=', name = target)
            },

            // 初始化搜索
            init_search_key() {
                let dom = document.querySelector('.search_key_input')
                let key = dom.getAttribute('data')
                this.search_key = key
            },

            // 获取热搜数据
            get_new_data(id, name, url, flag, size) {
                if (name === this.news_actives && !flag) {
                    return
                }
                this.news_actives = name
                this.news_actives_url = url

                let data = {
                    id,
                }
                if (size) {
                    data.size = size
                }

                axios.get(`https://api.codelife.cc/api/top/list?lang=cn&id=${data}`).then(res => {
                    this.news_list = res.data
                })
            },

            news_init_method(size) {
                this.get_new_data('KqndgxeLl9', '微博', 'https://files.codelife.cc/topsearch/KqndgxeLl9.png', true, size)
            },

            mood_show_comment_list(e) {
                let div = $(e.target).parent().parent().next()
                div.slideToggle()
            },

            // 发布心情
            mood_add_method() {
                axios.post('/api/moods/', this.mood_add).then(res => {
                    if (res.code) {
                        this.$message.error(res.msg)
                        this.$refs[`mood_add__${res.self}`].focus()
                        return
                    }
                    this.$message.success(res.msg)
                    setTimeout(() => {
                        location.reload()
                    }, 1000)
                })
            },

            // 删除心情
            mood_delete(nid, e) {
                this.$confirm('此操作将永久删除该心情, 是否继续?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    axios.delete(`/api/moods/${nid}/`).then(res => {
                        if (res.code) {
                            this.$message.error(res.msg)
                            return
                        }
                        this.$message.success(res.msg)
                        setTimeout(() => {
                            $(e.target).parents('.mood').remove()
                        }, 300)
                    })
                }).catch(() => {
                    this.$message({
                        type: 'warning',
                        message: '已取消删除'
                    });
                });
            },

            // 打开回复心情对话框
            mood_comment_dialogVisible_show(nid) {
                this.mood_comment_dialogVisible = true
                this.mood_comment_add_method.nid = nid
            },

            // 回复心情
            mood_comment_add_method() {
                let nid = this.mood_comment_add_method.nid
                axios.post(`/api/mood_comments/${nid}/`, this.mood_add_comment).then(res => {
                    if (res.code) {
                        this.$message.error(res.msg)
                        this.$refs[`mood_comment_add__${res.self}`].focus()
                        return
                    }
                    this.$message.success(res.msg)
                    setTimeout(() => {
                        location.reload()
                    }, 1000)
                })
            },

            // 删除心情评论
            mood_sub_comment_delete(nid, mood_id, e) {
                this.$confirm('此操作将永久删除该评论, 是否继续?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    // nid：评论id mood_id：心情id
                    axios.delete(`/api/mood_comments/${nid}/`, {
                        data: {
                            mood_id,
                        }
                    }).then(res => {
                        if (res.code) {
                            this.$message.error(res.msg)
                            return
                        }
                        this.$message.success(res.msg)
                        setTimeout(() => {
                            $(e.target).parents('.mood').find('.mood_comment_num').text(`评论（${res.data}）`)
                            $(e.target).parents('li').remove()
                        }, 300)
                    })
                }).catch(() => {
                    this.$message({
                        type: 'warning',
                        message: '已取消删除'
                    });
                });
            },

            // 心情点赞与心情评论点赞
            mood_digg(path, nid, e) {
                axios.put(`/api/${path}/${nid}/`).then(res => {
                    if (res.code) {
                        this.$message.error(res.msg)
                        return
                    }
                    this.$message.success(res.msg)
                    $(e.target).text(`点赞（${res.data}）`)
                })
            },

            // 图片上传函数
            uploadImgFromPaste(file) {
                axios.post('/api/paste_upload/', {image: file}).then(res => {
                    console.log(res)
                })
            },

            // 粘贴图片在回忆录
            paste_upload(e) {
                let clipboardData = (e.clipboardData || e.originalEvent.clipboardData);
                let items = clipboardData.items, len = items.length, blob = null;

                //在items里找粘贴的image,据上面分析,需要循环
                for (let i = 0; i < len; i++) {
                    if (items[i].type.indexOf("image") !== -1) {
                        //getAsFile() 此方法只是living standard firefox ie11 并不支持
                        blob = items[i].getAsFile();
                    }
                }
                if (blob !== null) {
                    // 读取图片文件
                    let reader = new FileReader();
                    reader.onload = (event) => {
                        // event.target.result 即为图片的Base64编码字符串
                        let base64_str = event.target.result
                        //可以在这里写上传逻辑 直接将base64编码的字符串上传（可以尝试传入blob对象，看看后台程序能否解析）
                        this.uploadImgFromPaste(base64_str);
                    }
                    reader.readAsDataURL(blob);
                    //阻止默认行为即不让剪贴板内容在div中显示出来
                    // e.preventDefault();
                }
            },

        },

        watch: {
            'mood_add.drawing'(n, o) {
                this.mood_show_drawing = n.split('\n')
            },
        }
    })

</script>

{% block js %}
    <script>
        // 图片轮播图
        let menu_img = document.querySelectorAll('.active')
        let banner = document.getElementById('banner_box')
        let banner_time = Number(banner.getAttribute('banner_time'))

        let menu_length = menu_img.length

        let index = 0
        let timer = null
        clearInterval(timer)
        timer = setInterval(() => {
            index++
            if (index === menu_length) {
                index = 0
            }
            for (let i of menu_img) {
                i.style.opacity = 0
            }
            menu_img[index].style.opacity = 1
            if (!banner_time) {
                clearInterval(timer)
            }
        }, banner_time * 1000)

        let banner_slogan = document.getElementById('banner_slogan')
        let slogan_list = eval(banner_slogan.getAttribute('lis'))
        let slogan_time = Number(banner_slogan.getAttribute('slogan_time'))

        let slogan_index = 0
        let slogan_timer = null

        slogan_timer = setInterval(() => {
            slogan_index++
            if (slogan_index === slogan_list.length) {
                slogan_index = 0
            }
            if (!slogan_time) {
                clearInterval(slogan_timer)
            } else {
                banner_slogan.innerText = slogan_list[slogan_index]
            }
        }, slogan_time * 1000)

        // 动态导航条
        let nav = document.querySelector('.nav_bg')

        let slider
        slider = document.querySelector('.slider_bar')
        let slider_top = 0
        let path = location.pathname
        if (path.indexOf('article') !== -1) {
            slider_top = $(slider).offset().top - 80
        }

        window.onscroll = function () {
            let top = document.documentElement.scrollTop
            if (top >= 460) {
                nav.classList.add('show')
            } else {
                nav.classList.remove('show')
            }

            if (slider) {
                if (top >= slider_top) {
                    slider.classList.add('fixed')
                } else {
                    slider.classList.remove('fixed')
                }
            }
        }
    </script>
{% endblock %}

{% block article_js %}

{% endblock %}
</body>
</html>